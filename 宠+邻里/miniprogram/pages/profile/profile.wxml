<!--ä¸ªäººä¸­å¿ƒé¡µé¢-->
<view class="profile-container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!isLoggedIn}}" class="login-section">
    <view class="login-avatar">
      <image class="avatar-placeholder" src="/images/avatar-placeholder.png" mode="aspectFill" />
    </view>
    <view class="login-text">ç‚¹å‡»ç™»å½•</view>
    <button class="login-btn" bindtap="login">å¾®ä¿¡ç™»å½•</button>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:else>
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-info">
      <view class="user-avatar">
        <image class="avatar" src="{{userInfo.avatarUrl || '/images/avatar-placeholder.png'}}" mode="aspectFill" />
      </view>
      <view class="user-details">
        <view class="user-name">{{userInfo.nickName || 'å® ç‰©çˆ±å¥½è€…'}}</view>
        <view class="user-stats">
          <view class="stat-item">
            <view class="stat-number">{{userStats.postCount || 0}}</view>
            <view class="stat-label">å‘å¸ƒ</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{userStats.likeCount || 0}}</view>
            <view class="stat-label">è·èµ</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{userStats.helpCount || 0}}</view>
            <view class="stat-label">å¸®åŠ©</view>
          </view>
        </view>
      </view>
      <view class="edit-profile" bindtap="editProfile">
        <text class="edit-icon">âœï¸</text>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-actions">
      <view class="action-item" bindtap="goToMyPosts">
        <view class="action-icon">ğŸ“</view>
        <view class="action-text">æˆ‘çš„å‘å¸ƒ</view>
        <view class="action-arrow">></view>
      </view>
      <view class="action-item" bindtap="goToMyLikes">
        <view class="action-icon">â¤ï¸</view>
        <view class="action-text">æˆ‘çš„ç‚¹èµ</view>
        <view class="action-arrow">></view>
      </view>
      <view class="action-item" bindtap="goToMyComments">
        <view class="action-icon">ğŸ’¬</view>
        <view class="action-text">æˆ‘çš„è¯„è®º</view>
        <view class="action-arrow">></view>
      </view>
    </view>

    <!-- æˆ‘çš„å¸–å­é¢„è§ˆ -->
    <view class="my-posts-preview">
      <view class="section-header">
        <view class="section-title">æœ€è¿‘å‘å¸ƒ</view>
        <view class="section-more" bindtap="goToMyPosts">æŸ¥çœ‹å…¨éƒ¨</view>
      </view>
      
      <view wx:if="{{recentPosts.length > 0}}" class="posts-grid">
        <view 
          wx:for="{{recentPosts}}" 
          wx:key="id" 
          class="post-card"
          bindtap="viewPost"
          data-id="{{item.id}}"
        >
          <view class="post-image">
            <image 
              wx:if="{{item.images && item.images.length > 0}}"
              src="{{item.images[0]}}" 
              mode="aspectFill" 
            />
            <view wx:else class="no-image">ğŸ“·</view>
          </view>
          <view class="post-info">
            <view class="post-title">{{item.title}}</view>
            <view class="post-meta">
              <view class="post-type {{item.type}}">{{item.typeText}}</view>
              <view class="post-time">{{item.createTimeRelative}}</view>
            </view>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-posts">
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-text">è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å¸–å­</view>
        <button class="publish-btn" bindtap="goToPublish">ç«‹å³å‘å¸ƒ</button>
      </view>
    </view>

    <!-- è®¾ç½®é€‰é¡¹ -->
    <view class="settings-section">
      <view class="section-header">
        <view class="section-title">è®¾ç½®</view>
      </view>
      
      <view class="settings-list">
        <view class="setting-item" bindtap="goToNotificationSettings">
          <view class="setting-icon">ğŸ””</view>
          <view class="setting-text">é€šçŸ¥è®¾ç½®</view>
          <view class="setting-arrow">></view>
        </view>
        <view class="setting-item" bindtap="goToPrivacySettings">
          <view class="setting-icon">ğŸ”’</view>
          <view class="setting-text">éšç§è®¾ç½®</view>
          <view class="setting-arrow">></view>
        </view>
        <view class="setting-item" bindtap="goToAbout">
          <view class="setting-icon">â„¹ï¸</view>
          <view class="setting-text">å…³äºæˆ‘ä»¬</view>
          <view class="setting-arrow">></view>
        </view>
        <view class="setting-item" bindtap="goToFeedback">
          <view class="setting-icon">ğŸ’Œ</view>
          <view class="setting-text">æ„è§åé¦ˆ</view>
          <view class="setting-arrow">></view>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>
</view>

<!-- ç¼–è¾‘èµ„æ–™å¼¹çª— -->
<view wx:if="{{showEditProfile}}" class="edit-modal" bindtap="closeEditProfile">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">ç¼–è¾‘èµ„æ–™</view>
      <view class="modal-close" bindtap="closeEditProfile">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="edit-item">
        <view class="edit-label">å¤´åƒ</view>
        <view class="edit-avatar" bindtap="chooseAvatar">
          <image class="edit-avatar-img" src="{{editUserInfo.avatarUrl || '/images/avatar-placeholder.png'}}" mode="aspectFill" />
          <view class="edit-avatar-overlay">
            <text class="camera-icon">ğŸ“·</text>
          </view>
        </view>
      </view>
      <view class="edit-item">
        <view class="edit-label">æ˜µç§°</view>
        <input 
          class="edit-input" 
          value="{{editUserInfo.nickName}}" 
          placeholder="è¯·è¾“å…¥æ˜µç§°"
          bindinput="onNickNameInput"
          maxlength="20"
        />
      </view>
      <view class="edit-item">
        <view class="edit-label">ä¸ªäººç®€ä»‹</view>
        <textarea 
          class="edit-textarea" 
          value="{{editUserInfo.bio}}" 
          placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±å§..."
          bindinput="onBioInput"
          maxlength="100"
        />
      </view>
    </view>
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="closeEditProfile">å–æ¶ˆ</button>
      <button class="save-btn" bindtap="saveProfile">ä¿å­˜</button>
    </view>
  </view>
</view>