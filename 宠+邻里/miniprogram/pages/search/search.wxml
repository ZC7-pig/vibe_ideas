<!--æœç´¢é¡µé¢-->
<view class="search-container">
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-input-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢å® ç‰©ä¿¡æ¯..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        focus="{{searchFocus}}"
        confirm-type="search"
      />
      <view class="search-btn" bindtap="onSearchConfirm">
        <text class="search-icon">ğŸ”</text>
      </view>
    </view>
    <view class="cancel-btn" bindtap="goBack">å–æ¶ˆ</view>
  </view>

  <!-- æœç´¢å†å² -->
  <view wx:if="{{!hasSearched && searchHistory.length > 0}}" class="search-history">
    <view class="history-header">
      <view class="history-title">æœç´¢å†å²</view>
      <view class="clear-history" bindtap="clearHistory">æ¸…ç©º</view>
    </view>
    <view class="history-tags">
      <view 
        wx:for="{{searchHistory}}" 
        wx:key="index" 
        class="history-tag"
        bindtap="searchFromHistory"
        data-keyword="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view wx:if="{{!hasSearched}}" class="hot-search">
    <view class="hot-title">çƒ­é—¨æœç´¢</view>
    <view class="hot-tags">
      <view 
        wx:for="{{hotKeywords}}" 
        wx:key="index" 
        class="hot-tag"
        bindtap="searchFromHot"
        data-keyword="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view wx:if="{{hasSearched}}" class="search-results">
    <!-- ç­›é€‰æ¡ä»¶ -->
    <view class="filter-bar">
      <scroll-view class="filter-scroll" scroll-x="{{true}}">
        <view class="filter-items">
          <view 
            class="filter-item {{activeFilter === 'all' ? 'active' : ''}}"
            bindtap="switchFilter"
            data-filter="all"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-item {{activeFilter === 'lost' ? 'active' : ''}}"
            bindtap="switchFilter"
            data-filter="lost"
          >
            å¯»å® 
          </view>
          <view 
            class="filter-item {{activeFilter === 'found' ? 'active' : ''}}"
            bindtap="switchFilter"
            data-filter="found"
          >
            æ¡åˆ°
          </view>
          <view 
            class="filter-item {{activeFilter === 'adoption' ? 'active' : ''}}"
            bindtap="switchFilter"
            data-filter="adoption"
          >
            é¢†å…»
          </view>
          <view 
            class="filter-item {{activeFilter === 'normal' ? 'active' : ''}}"
            bindtap="switchFilter"
            data-filter="normal"
          >
            æ—¥å¸¸
          </view>
        </view>
      </scroll-view>
      <view class="sort-btn" bindtap="showSortOptions">
        <text class="sort-text">{{sortText}}</text>
        <text class="sort-arrow">â–¼</text>
      </view>
    </view>

    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="result-stats">
      æ‰¾åˆ° {{totalCount}} æ¡ç›¸å…³ç»“æœ
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <scroll-view 
      class="results-list" 
      scroll-y="{{true}}"
      bindscrolltolower="loadMoreResults"
      refresher-enabled="{{true}}"
      refresher-triggered="{{refreshing}}"
      bindrefresherrefresh="onRefresh"
    >
      <!-- åŠ è½½ä¸­ -->
      <view wx:if="{{loading && results.length === 0}}" class="loading-container">
        <view class="loading-spinner"></view>
        <view class="loading-text">æœç´¢ä¸­...</view>
      </view>

      <!-- æœç´¢ç»“æœ -->
      <view wx:elif="{{results.length > 0}}" class="result-items">
        <view 
          wx:for="{{results}}" 
          wx:key="id" 
          class="result-item"
          bindtap="viewPost"
          data-id="{{item.id}}"
        >
          <!-- å¸–å­å›¾ç‰‡ -->
          <view class="result-image">
            <image 
              wx:if="{{item.images && item.images.length > 0}}"
              src="{{item.images[0]}}" 
              mode="aspectFill" 
            />
            <view wx:else class="no-image">ğŸ“·</view>
          </view>

          <!-- å¸–å­ä¿¡æ¯ -->
          <view class="result-content">
            <view class="result-header">
              <view class="post-type {{item.type}}">{{item.typeText}}</view>
              <view class="post-time">{{item.createTimeRelative}}</view>
            </view>
            
            <view class="result-title">{{item.title}}</view>
            <view class="result-description">{{item.description}}</view>
            
            <!-- å® ç‰©æ ‡ç­¾ -->
            <view wx:if="{{item.petInfo}}" class="pet-tags">
              <view wx:if="{{item.petInfo.breed}}" class="pet-tag">{{item.petInfo.breed}}</view>
              <view wx:if="{{item.petInfo.color}}" class="pet-tag">{{item.petInfo.color}}</view>
              <view wx:if="{{item.petInfo.sex}}" class="pet-tag">{{item.petInfo.sex}}</view>
            </view>
            
            <!-- ä½ç½®ä¿¡æ¯ -->
            <view wx:if="{{item.location}}" class="result-location">
              <text class="location-icon">ğŸ“</text>
              <text class="location-text">{{item.location.address}}</text>
              <text wx:if="{{item.distance}}" class="distance-text">{{item.distance}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-container">
        <view class="empty-icon">ğŸ”</view>
        <view class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</view>
        <view class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–ç­›é€‰æ¡ä»¶</view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{hasMore && results.length > 0}}" class="load-more">
        <view wx:if="{{loadingMore}}" class="loading-more">
          <view class="loading-spinner small"></view>
          <text>åŠ è½½ä¸­...</text>
        </view>
        <view wx:else class="load-more-btn" bindtap="loadMoreResults">
          ç‚¹å‡»åŠ è½½æ›´å¤š
        </view>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:if="{{!hasMore && results.length > 0}}" class="no-more">
        æ²¡æœ‰æ›´å¤šç»“æœäº†
      </view>
    </scroll-view>
  </view>
</view>

<!-- æ’åºé€‰é¡¹å¼¹çª— -->
<view wx:if="{{showSortModal}}" class="sort-modal" bindtap="hideSortOptions">
  <view class="sort-content" catchtap="stopPropagation">
    <view class="sort-title">æ’åºæ–¹å¼</view>
    <view class="sort-options">
      <view 
        class="sort-option {{sortType === 'time' ? 'active' : ''}}"
        bindtap="selectSort"
        data-sort="time"
      >
        <text class="option-text">æŒ‰æ—¶é—´æ’åº</text>
        <text wx:if="{{sortType === 'time'}}" class="check-icon">âœ“</text>
      </view>
      <view 
        class="sort-option {{sortType === 'distance' ? 'active' : ''}}"
        bindtap="selectSort"
        data-sort="distance"
      >
        <text class="option-text">æŒ‰è·ç¦»æ’åº</text>
        <text wx:if="{{sortType === 'distance'}}" class="check-icon">âœ“</text>
      </view>
      <view 
        class="sort-option {{sortType === 'relevance' ? 'active' : ''}}"
        bindtap="selectSort"
        data-sort="relevance"
      >
        <text class="option-text">æŒ‰ç›¸å…³åº¦æ’åº</text>
        <text wx:if="{{sortType === 'relevance'}}" class="check-icon">âœ“</text>
      </view>
    </view>
  </view>
</view>