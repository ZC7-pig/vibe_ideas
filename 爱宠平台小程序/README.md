# 宠物生活平台小程序

一个专注于宠物寻找、寄养、收养的本地化服务平台，通过智能匹配算法帮助走失宠物回家。

## 功能特性

### 核心功能
- 🔍 **宠物寻找** - 发布寻宠/发现信息，智能匹配推送
- 🏠 **寄养服务** - 提供/寻求宠物寄养服务
- 💕 **配种服务** - 宠物配种信息发布与匹配
- 🤗 **流浪收养** - 流浪动物收养信息平台
- 🏥 **本地服务** - 宠物医院、活动等本地服务入口

### 技术特性
- 基于微信小程序原生框架开发
- 使用微信云开发（云函数 + 云数据库 + 云存储）
- 智能匹配算法（品种、毛色、地理位置、时间）
- 实时消息推送与提醒
- 响应式设计，支持多种屏幕尺寸

## 项目结构

```
pet-platform-miniprogram/
├── app.js                 # 小程序入口文件
├── app.json               # 小程序配置文件
├── app.wxss               # 全局样式文件
├── config.js              # 配置文件和常量定义
├── pages/                 # 页面目录
│   ├── home/              # 首页
│   ├── post/              # 帖子相关页面
│   │   ├── create         # 发布页面
│   │   ├── detail         # 详情页面
│   │   └── list           # 列表页面
│   ├── profile/           # 个人中心
│   ├── notifications/     # 消息中心
│   ├── adoption/          # 收养列表
│   └── services/          # 本地服务
├── cloudfunctions/        # 云函数目录
│   ├── createPost/        # 创建帖子
│   ├── listPosts/         # 获取帖子列表
│   ├── getPostDetail/     # 获取帖子详情
│   ├── matchPosts/        # 帖子匹配算法
│   ├── listNotifications/ # 获取通知列表
│   └── updateUserProfile/ # 更新用户资料
├── assets/                # 静态资源
├── project.config.json    # 项目配置
└── sitemap.json          # 站点地图
```

## 快速开始

### 环境要求
- 微信开发者工具
- 微信小程序账号
- 微信云开发环境

### 安装步骤

1. **克隆项目**
   ```bash
   git clone [项目地址]
   cd pet-platform-miniprogram
   ```

2. **配置云开发环境**
   - 在微信开发者工具中打开项目
   - 创建云开发环境
   - 修改 `config.js` 中的 `CLOUD_ENV` 为你的环境ID
   - 修改 `app.js` 中的云环境ID

3. **部署云函数**
   - 在微信开发者工具中右键每个云函数文件夹
   - 选择"上传并部署：云端安装依赖"

4. **初始化数据库**
   - 在云开发控制台创建以下集合：
     - `users` - 用户信息
     - `posts` - 帖子信息
     - `notifications` - 通知信息
   - 配置相应的索引（参考产品规格说明）

5. **配置权限**
   - 在云开发控制台设置数据库权限
   - 配置云存储权限

### 配置说明

#### 主要配置项（config.js）
```javascript
export const CONFIG = {
  DEFAULT_RADIUS_KM: 5,        // 默认搜索半径
  MATCH_SCORE_THRESHOLD: 70,   // 匹配阈值
  MATCH_RECENT_DAYS: 7,        // 匹配时间范围
  PAGE_SIZE: 20,               // 分页大小
  MAX_IMAGES: 9,               // 最大图片数量
  CLOUD_ENV: 'your-env-id'     // 云环境ID
}
```

#### 数据库索引建议
- `posts` 集合：
  - `type + createTime` 组合索引
  - `userId + createTime` 组合索引
  - 文本索引：`title, breed, color, description`
- `notifications` 集合：
  - `userId + createTime` 组合索引
  - `isRead` 单字段索引

## 核心功能说明

### 智能匹配算法
系统基于以下维度进行匹配：
- **品种匹配**（权重40-50%）：完全匹配或模糊匹配
- **毛色匹配**（权重20-30%）：完全匹配或相似色匹配
- **地理位置**（权重20%）：5公里内满分，10公里内部分分数
- **时间范围**（权重10%）：3天内满分，7天内部分分数

### 匹配触发机制
- **即时匹配**：新帖发布后立即触发
- **定时匹配**：每15分钟扫描近期帖子进行批量匹配
- **手动匹配**：用户在详情页点击"相似提醒"

### 消息推送
- 匹配成功后向双方推送通知
- 支持未读消息计数
- 提供消息中心统一管理

## 开发指南

### 添加新页面
1. 在 `pages/` 目录下创建页面文件夹
2. 创建 `.wxml`, `.wxss`, `.js`, `.json` 文件
3. 在 `app.json` 中注册页面路径

### 添加新云函数
1. 在 `cloudfunctions/` 目录下创建函数文件夹
2. 创建 `index.js` 和 `package.json`
3. 在微信开发者工具中上传部署

### 样式规范
- 使用CSS变量定义主题色彩
- 遵循响应式设计原则
- 使用rpx单位适配不同屏幕

### 代码规范
- 使用ES6+语法
- 遵循小程序开发最佳实践
- 添加适当的错误处理和用户反馈

## 部署上线

### 小程序发布
1. 在微信开发者工具中点击"上传"
2. 填写版本号和项目备注
3. 在微信公众平台提交审核
4. 审核通过后发布上线

### 云函数部署
1. 确保所有云函数已上传部署
2. 检查云数据库权限配置
3. 测试云函数功能正常

## 常见问题

### Q: 云函数调用失败
A: 检查云环境ID配置是否正确，确保云函数已正确部署

### Q: 图片上传失败
A: 检查云存储权限配置，确保有上传权限

### Q: 匹配功能不工作
A: 检查 `matchPosts` 云函数是否正常，数据库中是否有测试数据

### Q: 定位功能异常
A: 确保在 `app.json` 中配置了位置权限，用户已授权位置信息

## 技术支持

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件至：[邮箱地址]
- 微信：pethelper2024

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 实现核心功能：寻宠、发现、寄养、配种、收养
- 智能匹配算法
- 消息推送系统
- 用户管理系统

---

**注意**：这是一个演示版本，实际使用时请根据具体需求进行调整和优化。