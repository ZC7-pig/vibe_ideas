# Mac版微信开发者工具 - 云函数部署指南

## 🍎 Mac版特殊说明

Mac版微信开发者工具的界面和操作方式与Windows版有所不同，本指南专门针对Mac版本。

## 📋 部署前准备

### 1. 确保项目配置正确

已为您配置好以下文件：
- ✅ `project.config.json` - 已添加 `cloudfunctionRoot` 配置
- ✅ `config.js` - 云环境配置
- ✅ 所有云函数的 `package.json` 文件

### 2. 需要您手动配置的项目

1. **替换AppID**
   - 打开 `project.config.json`
   - 将 `"appid": "your-app-id"` 替换为您的实际AppID

2. **配置云环境ID**
   - 打开 `config.js`
   - 将 `CLOUD_ENV: 'pet-platform-demo'` 替换为您的实际云环境ID

## 🚀 Mac版云函数部署步骤

### 方法一：通过微信开发者工具界面（推荐）

#### 步骤1：开通云开发
1. 在微信开发者工具中打开项目
2. 点击顶部工具栏的 **"云开发"** 图标（云朵状）
3. 如果未开通，点击 **"开通"** 按钮
4. 创建云环境：
   - 环境名称：`pet-platform-demo`（或其他名称）
   - 选择合适的套餐（开发阶段可选免费版）

#### 步骤2：部署云函数
1. **重启微信开发者工具**（让配置生效）
2. **打开云开发控制台**：
   - 点击工具栏的 **"云开发"** 按钮
   - 选择 **"云函数"** 标签页
3. **上传云函数**：
   - 您应该能看到项目中的所有云函数
   - 对每个云函数点击 **"上传并部署"** 按钮
   - 选择 **"云端安装依赖"** 选项

#### 步骤3：验证部署
1. 在云函数列表中查看状态
2. 状态显示为 **"部署成功"** 即可

### 方法二：使用命令行辅助

如果界面操作有问题，可以使用命令行：

```bash
# 在项目根目录下运行
./deploy-functions.sh
```

这个脚本会：
- 检查所有云函数的完整性
- 提供详细的部署指导
- 确保所有依赖都已准备好

### 方法三：手动逐个部署

如果批量部署有问题，可以逐个部署：

1. **进入云开发控制台**
2. **点击"新建云函数"**
3. **选择"上传文件夹"**
4. **选择具体的云函数目录**（如 `cloudfunctions/listPosts`）
5. **等待上传和部署完成**

## 📦 需要部署的云函数列表

- ✅ `createPost` - 创建帖子
- ✅ `getPostDetail` - 获取帖子详情
- ✅ `listNotifications` - 获取通知列表
- ✅ `listPosts` - 获取帖子列表
- ✅ `matchPosts` - 智能匹配
- ✅ `updateUserProfile` - 更新用户资料

## 🔧 常见问题解决

### 问题1：看不到云函数选项
**解决方案：**
- 确保 `project.config.json` 中有 `"cloudfunctionRoot": "cloudfunctions/"`
- 重启微信开发者工具
- 确保已开通云开发

### 问题2：上传失败
**解决方案：**
- 检查网络连接
- 确保微信开发者工具已登录
- 尝试逐个上传而不是批量上传

### 问题3：依赖安装失败
**解决方案：**
- 选择"云端安装依赖"选项
- 确保 `package.json` 文件格式正确
- 检查依赖版本兼容性

### 问题4：环境ID不匹配
**解决方案：**
- 确保 `config.js` 中的环境ID与实际创建的一致
- 确保 `app.js` 中的云开发初始化使用正确的环境ID

## 🎯 部署后验证

### 1. 在云开发控制台验证
- 云函数列表显示所有函数
- 状态为"正常"或"部署成功"

### 2. 在小程序中测试
- 打开小程序首页
- 查看是否能正常加载数据
- 测试发布功能

### 3. 查看日志
- 在云开发控制台的"日志"标签页
- 查看云函数调用日志
- 确认没有错误信息

## 📱 数据库初始化

部署云函数后，还需要在云开发控制台创建数据库集合：

1. **进入"数据库"标签页**
2. **创建以下集合：**
   - `posts` - 帖子数据
   - `users` - 用户数据
   - `notifications` - 通知数据

3. **设置权限：**
   - 开发阶段可设置为"所有用户可读写"
   - 生产环境建议设置更严格的权限

## ✅ 完成检查清单

- [ ] 已开通云开发环境
- [ ] 已配置正确的AppID
- [ ] 已配置正确的云环境ID
- [ ] 已部署所有6个云函数
- [ ] 已创建数据库集合
- [ ] 已测试小程序基本功能

完成以上步骤后，您的爱宠平台小程序就可以正常运行了！🎉