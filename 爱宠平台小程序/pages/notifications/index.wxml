<!--pages/notifications/index.wxml-->
<view class="page-container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-container">
    <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" 
          data-type="all" bindtap="onFilterChange">
      å…¨éƒ¨
    </view>
    <view class="filter-item {{currentFilter === 'unread' ? 'active' : ''}}" 
          data-type="unread" bindtap="onFilterChange">
      æœªè¯»
    </view>
    <view class="filter-item {{currentFilter === 'match' ? 'active' : ''}}" 
          data-type="match" bindtap="onFilterChange">
      åŒ¹é…æé†’
    </view>
  </view>

  <!-- é€šçŸ¥åˆ—è¡¨ -->
  <view class="notifications-container">
    <block wx:if="{{loading}}">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{notifications.length > 0}}">
      <view class="notification-item {{!item.isRead ? 'unread' : ''}}" 
            wx:for="{{notifications}}" 
            wx:key="_id"
            bindtap="onNotificationTap"
            data-id="{{item._id}}"
            data-post-id="{{item.postId}}"
            data-matched-post-id="{{item.matchedPostId}}">
        
        <view class="notification-content">
          <!-- é€šçŸ¥å›¾æ ‡ -->
          <view class="notification-icon">
            <text class="icon-text">ğŸ””</text>
            <view class="unread-dot" wx:if="{{!item.isRead}}"></view>
          </view>

          <!-- é€šçŸ¥ä¿¡æ¯ -->
          <view class="notification-info">
            <text class="notification-message">{{item.message}}</text>
            <view class="notification-meta">
              <text class="notification-time">{{item.createTimeText}}</text>
              <text class="notification-score" wx:if="{{item.score}}">
                åŒ¹é…åº¦: {{item.score}}%
              </text>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="notification-actions">
            <view class="action-btn" 
                  bindtap="onViewPostTap" 
                  data-post-id="{{item.matchedPostId}}"
                  catchtap="true">
              æŸ¥çœ‹
            </view>
          </view>
        </view>

        <!-- ç›¸å…³å¸–å­é¢„è§ˆ -->
        <view class="related-post" wx:if="{{item.relatedPost}}">
          <image class="related-image" 
                 src="{{item.relatedPost.images[0]}}" 
                 mode="aspectFill"
                 wx:if="{{item.relatedPost.images.length > 0}}">
          </image>
          <view class="related-info">
            <text class="related-title">{{item.relatedPost.title}}</text>
            <text class="related-meta">
              {{item.relatedPost.breed}} Â· {{item.relatedPost.color}} Â· {{item.relatedPost.location.name}}
            </text>
          </view>
        </view>
      </view>
    </block>

    <block wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-text">æš‚æ— é€šçŸ¥</text>
        <text class="empty-desc">å‘å¸ƒä¿¡æ¯åä¼šæ”¶åˆ°ç›¸å…³åŒ¹é…æé†’</text>
      </view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ“ä½œæ  -->
  <view class="action-bar" wx:if="{{notifications.length > 0}}">
    <button class="action-btn-large secondary" bindtap="onMarkAllRead">
      å…¨éƒ¨å·²è¯»
    </button>
    <button class="action-btn-large primary" bindtap="onClearRead">
      æ¸…é™¤å·²è¯»
    </button>
  </view>
</view>