<!--pages/adoption/list.wxml-->
<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <text class="header-title">æµæµªåŠ¨ç‰©æ”¶å…»</text>
    <text class="header-desc">ç»™å®ƒä»¬ä¸€ä¸ªæ¸©æš–çš„å®¶</text>
  </view>

  <!-- æ”¶å…»åˆ—è¡¨ -->
  <view class="adoption-container">
    <block wx:if="{{loading}}">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{adoptions.length > 0}}">
      <view class="adoption-item" 
            wx:for="{{adoptions}}" 
            wx:key="_id"
            bindtap="onAdoptionTap"
            data-id="{{item._id}}">
        
        <!-- å® ç‰©å›¾ç‰‡ -->
        <view class="pet-images">
          <swiper class="image-swiper" indicator-dots="{{item.images.length > 1}}" autoplay="false">
            <swiper-item wx:for="{{item.images}}" wx:key="index" wx:for-item="image">
              <image class="pet-image" src="{{image}}" mode="aspectFill"></image>
            </swiper-item>
          </swiper>
          <view class="status-tag {{item.adoptStatus}}">
            {{item.adoptStatusText}}
          </view>
        </view>

        <!-- å® ç‰©ä¿¡æ¯ -->
        <view class="pet-info">
          <text class="pet-title">{{item.title}}</text>
          
          <view class="pet-details">
            <view class="detail-row">
              <text class="detail-label">å“ç§ï¼š</text>
              <text class="detail-value">{{item.breed}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">æ¯›è‰²ï¼š</text>
              <text class="detail-value">{{item.color}}</text>
            </view>
            <view class="detail-row">
              <text class="detail-label">åœ°ç‚¹ï¼š</text>
              <text class="detail-value">{{item.location.name}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.age}}">
              <text class="detail-label">å¹´é¾„ï¼š</text>
              <text class="detail-value">{{item.age}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.health}}">
              <text class="detail-label">å¥åº·ï¼š</text>
              <text class="detail-value">{{item.health}}</text>
            </view>
          </view>

          <text class="pet-description">{{item.description}}</text>

          <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
          <view class="publisher-info" wx:if="{{item.userInfo}}">
            <image class="publisher-avatar" src="{{item.userInfo.avatarUrl}}" mode="aspectFill"></image>
            <view class="publisher-details">
              <text class="publisher-name">{{item.userInfo.nickName}}</text>
              <text class="publish-time">{{item.createTimeText}}</text>
            </view>
          </view>
          <view class="publisher-info" wx:else>
            <view class="publisher-details">
              <text class="publish-time">{{item.createTimeText}}</text>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="action-buttons" wx:if="{{item.adoptStatus === 'pending'}}">
            <button class="action-btn secondary" 
                    bindtap="onContactTap" 
                    data-contact="{{item.contact}}"
                    catchtap="true">
              è”ç³»å‘å¸ƒè€…
            </button>
            <button class="action-btn primary" 
                    bindtap="onApplyTap" 
                    data-id="{{item._id}}"
                    catchtap="true">
              ç”³è¯·é¢†å…»
            </button>
          </view>
        </view>
      </view>
    </block>

    <block wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ¾</text>
        <text class="empty-text">æš‚æ— å¾…é¢†å…»ä¿¡æ¯</text>
        <text class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡æ”¶å…»ä¿¡æ¯å§</text>
        <button class="empty-btn" bindtap="onPublishTap">å‘å¸ƒæ”¶å…»ä¿¡æ¯</button>
      </view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ•‘åŠ©ç«™ä¿¡æ¯ -->
  <view class="rescue-section">
    <text class="section-title">åˆä½œæ•‘åŠ©ç«™</text>
    <view class="rescue-list">
      <view class="rescue-item" wx:for="{{rescueStations}}" wx:key="id">
        <view class="rescue-info">
          <text class="rescue-name">{{item.name}}</text>
          <text class="rescue-address">{{item.address}}</text>
        </view>
        <button class="rescue-contact" 
                bindtap="onCallRescue" 
                data-phone="{{item.phone}}">
          è”ç³»
        </button>
      </view>
    </view>
  </view>

  <!-- ç”³è¯·é¢†å…»å¼¹çª— -->
  <view class="apply-modal" wx:if="{{showApplyModal}}" bindtap="onCloseApplyModal">
    <view class="apply-content" catchtap="stopPropagation">
      <view class="apply-header">
        <text class="apply-title">ç”³è¯·é¢†å…»</text>
        <icon class="apply-close" type="cancel" size="20" bindtap="onCloseApplyModal"></icon>
      </view>
      
      <form bindsubmit="onSubmitApplication">
        <view class="apply-form">
          <view class="form-item">
            <text class="form-label">å§“å *</text>
            <input class="form-input" name="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" value="{{applicationForm.name}}"/>
          </view>
          <view class="form-item">
            <text class="form-label">è”ç³»æ–¹å¼ *</text>
            <input class="form-input" name="contact" placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–å¾®ä¿¡å·" value="{{applicationForm.contact}}"/>
          </view>
          <view class="form-item">
            <text class="form-label">å±…ä½ç¯å¢ƒ</text>
            <textarea class="form-textarea" name="environment" placeholder="è¯·ç®€è¿°æ‚¨çš„å±…ä½ç¯å¢ƒå’Œå…»å® æ¡ä»¶" value="{{applicationForm.environment}}"></textarea>
          </view>
          <view class="form-item">
            <text class="form-label">å…»å® ç»éªŒ</text>
            <textarea class="form-textarea" name="experience" placeholder="è¯·ç®€è¿°æ‚¨çš„å…»å® ç»éªŒ" value="{{applicationForm.experience}}"></textarea>
          </view>
        </view>
        
        <view class="apply-actions">
          <button class="apply-btn secondary" bindtap="onCloseApplyModal">å–æ¶ˆ</button>
          <button class="apply-btn primary" formType="submit">æäº¤ç”³è¯·</button>
        </view>
      </form>
    </view>
  </view>
</view>