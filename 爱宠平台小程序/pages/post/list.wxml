<!--pages/post/list.wxml-->
<view class="page-container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-container" wx:if="{{showFilter}}">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" 
            data-type="all" bindtap="onFilterChange">
        å…¨éƒ¨
      </view>
      <view class="filter-item {{currentFilter === 'lost' ? 'active' : ''}}" 
            data-type="lost" bindtap="onFilterChange">
        å¯»å® 
      </view>
      <view class="filter-item {{currentFilter === 'found' ? 'active' : ''}}" 
            data-type="found" bindtap="onFilterChange">
        å‘ç°
      </view>
      <view class="filter-item {{currentFilter === 'foster' ? 'active' : ''}}" 
            data-type="foster" bindtap="onFilterChange">
        å¯„å…»
      </view>
      <view class="filter-item {{currentFilter === 'breed' ? 'active' : ''}}" 
            data-type="breed" bindtap="onFilterChange">
        é…ç§
      </view>
      <view class="filter-item {{currentFilter === 'adopt' ? 'active' : ''}}" 
            data-type="adopt" bindtap="onFilterChange">
        æ”¶å…»
      </view>
    </scroll-view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="posts-container">
    <block wx:if="{{loading}}">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{posts.length > 0}}">
      <view class="post-item" 
            wx:for="{{posts}}" 
            wx:key="_id"
            bindtap="onPostTap"
            data-id="{{item._id}}">
        
        <view class="post-card">
          <!-- å¸–å­å¤´éƒ¨ -->
          <view class="post-header">
            <view class="post-type-tag {{item.type}}">{{item.typeText}}</view>
            <view class="post-status {{item.status || 'active'}}">
              {{item.statusText || 'è¿›è¡Œä¸­'}}
            </view>
            <view class="post-actions" wx:if="{{listType === 'my'}}">
              <icon type="more" size="16" color="#999" bindtap="onMoreTap" data-id="{{item._id}}" catchtap="true"></icon>
            </view>
          </view>

          <!-- å¸–å­å†…å®¹ -->
          <view class="post-content">
            <text class="post-title">{{item.title}}</text>
            <view class="post-meta">
              <text class="meta-item">{{item.breed}}</text>
              <text class="meta-item">{{item.color}}</text>
              <text class="meta-item">{{item.location.name}}</text>
            </view>
          </view>

          <!-- å¸–å­å›¾ç‰‡ -->
          <view class="post-images" wx:if="{{item.images.length > 0}}">
            <image 
              class="post-image" 
              src="{{item.images[0]}}" 
              mode="aspectFill"
              lazy-load="true">
            </image>
            <view class="image-count" wx:if="{{item.images.length > 1}}">
              +{{item.images.length - 1}}
            </view>
          </view>

          <!-- å¸–å­åº•éƒ¨ -->
          <view class="post-footer">
            <text class="post-time">{{item.createTimeText}}</text>
            <view class="post-stats">
              <text class="stat-item">æµè§ˆ {{item.viewCount || 0}}</text>
              <text class="stat-item" wx:if="{{item.matchCount}}">åŒ¹é… {{item.matchCount}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <block wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">{{emptyText}}</text>
        <text class="empty-desc">{{emptyDesc}}</text>
        <button class="empty-btn" bindtap="onEmptyAction" wx:if="{{showEmptyAction}}">
          {{emptyActionText}}
        </button>
      </view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ“ä½œèœå• -->
  <view class="action-sheet" wx:if="{{showActionSheet}}" bindtap="onCloseActionSheet">
    <view class="action-content" catchtap="stopPropagation">
      <view class="action-header">
        <text class="action-title">é€‰æ‹©æ“ä½œ</text>
        <icon class="action-close" type="cancel" size="20" bindtap="onCloseActionSheet"></icon>
      </view>
      <view class="action-list">
        <view class="action-item" bindtap="onEditPost">
          <icon type="edit" size="16"></icon>
          <text>ç¼–è¾‘</text>
        </view>
        <view class="action-item" bindtap="onSharePost">
          <icon type="download" size="16"></icon>
          <text>åˆ†äº«</text>
        </view>
        <view class="action-item danger" bindtap="onDeletePost">
          <icon type="cancel" size="16"></icon>
          <text>åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>
</view>