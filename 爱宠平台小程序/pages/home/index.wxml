<!--pages/home/index.wxml-->
<view class="page-container">
  <!-- æœç´¢æ  -->
  <view class="search-container">
    <view class="search-box">
      <icon class="search-icon" type="search" size="16" color="#999"></icon>
      <input 
        class="search-input" 
        placeholder="æœç´¢å® ç‰©å“ç§ã€åœ°ç‚¹..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">æœç´¢</view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-container">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" 
            data-type="all" bindtap="onFilterChange">
        å…¨éƒ¨
      </view>
      <view class="filter-item {{currentFilter === 'lost' ? 'active' : ''}}" 
            data-type="lost" bindtap="onFilterChange">
        å¯»å® 
      </view>
      <view class="filter-item {{currentFilter === 'found' ? 'active' : ''}}" 
            data-type="found" bindtap="onFilterChange">
        å‘ç°
      </view>
      <view class="filter-item {{currentFilter === 'foster' ? 'active' : ''}}" 
            data-type="foster" bindtap="onFilterChange">
        å¯„å…»
      </view>
      <view class="filter-item {{currentFilter === 'breed' ? 'active' : ''}}" 
            data-type="breed" bindtap="onFilterChange">
        é…ç§
      </view>
      <view class="filter-item {{currentFilter === 'adopt' ? 'active' : ''}}" 
            data-type="adopt" bindtap="onFilterChange">
        æ”¶å…»
      </view>
    </scroll-view>
  </view>

  <!-- ä¿¡æ¯æµ -->
  <view class="posts-container">
    <block wx:if="{{loading}}">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{posts.length > 0}}">
      <view class="post-item" 
            wx:for="{{posts}}" 
            wx:key="_id" 
            bindtap="onPostTap" 
            data-id="{{item._id}}">
        <!-- å¸–å­å¡ç‰‡ -->
        <view class="post-card">
          <!-- ç”¨æˆ·ä¿¡æ¯ -->
          <view class="post-header" wx:if="{{item.userInfo}}">
            <image class="user-avatar" src="{{item.userInfo.avatarUrl}}" mode="aspectFill"></image>
            <view class="user-info">
              <text class="user-name">{{item.userInfo.nickName}}</text>
              <text class="post-time">{{item.createTimeText}}</text>
            </view>
            <view class="post-type-tag {{item.type}}">{{item.typeText}}</view>
          </view>
          <view class="post-header" wx:else>
            <view class="user-info">
              <text class="post-time">{{item.createTimeText}}</text>
            </view>
            <view class="post-type-tag {{item.type}}">{{item.typeText}}</view>
          </view>

          <!-- å¸–å­å†…å®¹ -->
          <view class="post-content">
            <text class="post-title">{{item.title}}</text>
            <view class="post-meta">
              <text class="meta-item">å“ç§ï¼š{{item.breed}}</text>
              <text class="meta-item">æ¯›è‰²ï¼š{{item.color}}</text>
              <text class="meta-item">åœ°ç‚¹ï¼š{{item.location.name}}</text>
            </view>
          </view>

          <!-- å›¾ç‰‡ -->
          <view class="post-images" wx:if="{{item.images.length > 0}}">
            <image 
              class="post-image" 
              src="{{item.images[0]}}" 
              mode="aspectFill"
              lazy-load="true">
            </image>
            <view class="image-count" wx:if="{{item.images.length > 1}}">
              +{{item.images.length - 1}}
            </view>
          </view>

          <!-- æ“ä½œæ  -->
          <view class="post-actions">
            <view class="action-item" bindtap="onLikeTap" data-id="{{item._id}}" catchtap="true">
              <icon type="{{item.liked ? 'success' : 'circle'}}" size="16"></icon>
              <text>{{item.likeCount || 0}}</text>
            </view>
            <view class="action-item" bindtap="onCommentTap" data-id="{{item._id}}" catchtap="true">
              <icon type="chat" size="16"></icon>
              <text>è”ç³»</text>
            </view>
            <view class="action-item" bindtap="onShareTap" data-id="{{item._id}}" catchtap="true">
              <icon type="download" size="16"></icon>
              <text>åˆ†äº«</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <block wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ¾</text>
        <text class="empty-text">æš‚æ— ç›¸å…³ä¿¡æ¯</text>
        <text class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡ä¿¡æ¯å§</text>
      </view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- å¿«é€Ÿå‘å¸ƒæŒ‰é’® -->
  <view class="fab" bindtap="onFabTap">
    <icon type="plus" size="24" color="white"></icon>
  </view>
</view>